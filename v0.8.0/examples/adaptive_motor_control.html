

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Nonlinear adaptive control &#8212; Nengo Loihi 0.8.0 docs</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/mmenu.all.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/components.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/nengo.css" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<!--[if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
<script type="text/javascript" src="https://cdn.crate.io/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/modernizr.js"></script>
    <script type="text/javascript" src="../_static/js/underscore.min.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/searchtools.js"></script>
    <script type="text/javascript" src="../_static/js/webflow.js"></script>
    <script type="text/javascript" src="../_static/js/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/js/mmenu.all.min.js"></script>
    <script type="text/javascript" src="../_static/js/fontawesome.js"></script>
    <script type="text/javascript" src="../_static/js/custom.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "ignoreClass": "document", "processEscapes": true, "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API reference" href="../api.html" />
    <link rel="prev" title="Convolutional networks" href="mnist_convnet.html" />
<link rel="stylesheet" type="text/css" href="../_static/custom.css">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41658423-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-41658423-2');
</script>

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>
<header class="header-nav">
  <div class="container">
    <div class="navbar w-nav" data-animation="default" data-collapse="small" data-contain="1" data-duration="400">
      <a class="brand w-nav-brand" href="https://www.nengo.ai/">
        <img src="https://www.nengo.ai/design/_images/general-full-light.svg" width="120">
      </a>
      <nav class="w-nav-menu main-nav" role="navigation">
        <div class="dropdownBackground">
          <span class="arrow"></span>
        </div>
        <ul id="menu-top-navigation" class="menu">
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/overview.html">Overview</a>
            <ul class="sub-menu">
                <li class="menu-item"><a href="https://www.nengo.ai/quickstart.html">Quick Start</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/documentation.html">Documentation</a>
            <table class="sub-menu">
              <tr>
                <td class="menu-heading">Core</td>
                <td class="menu-heading">Backends</td>
                <td class="menu-heading">Add-ons</td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo">Nengo</a></td>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-fpga">Nengo FPGA</a></td>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-examples">Nengo Examples</a></td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-dl/">Nengo DL</a></td>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-loihi">Nengo Loihi</a></td>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-extras/">Nengo Extras</a></td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-gui">Nengo GUI</a></td>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-mpi">Nengo MPI</a></td>
                <td class="menu-item"><a href="https://arvoelke.github.io/nengolib-docs/">Nengo Lib</a></td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-spa/">Nengo SPA</a></td>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-ocl">Nengo OpenCL</a></td>
                <td class="menu-item"></td>
              </tr>
              <tr>
                <td class="menu-item"></td>
                <td class="menu-item"><a href="https://github.com/project-rig/nengo_spinnaker">Nengo SpiNNaker</a></td>
                <td class="menu-item"></td>
              </tr>
            </table>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/community.html">Community</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://forum.nengo.ai/">Forum</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/publications.html">Publications</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/summerschool.html">Summer School</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/videos.html">Videos</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/people.html">People</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/projects.html">Development</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://www.nengo.ai/contributing.html">Contributor Guide</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/projects.html">Ecosystem</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item"><a href="https://www.nengo.ai/README.html">About</a></li>
          <li class="btn-link w-nav-link menu-item"><a href="https://www.nengo.ai/download.html">Download</a></li>
        </ul>
      </nav>

      <div id="mobile-nav" class="mm-menu">
        <ul class="offcanvas-menu">
          <li class="navlink w-nav-link menu-item"><a href="https://www.nengo.ai/overview.html">Overview</a></li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/documentation.html">Documentation</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://www.nengo.ai/quickstart.html">Quick Start</a></li>
              <li class="menu-item"><a href="http://www.nengo.ai/nengo">NengoCore</a></li>
              <li class="menu-item"><a href="https://github.com/nengo/nengo-gui#nengo-gui">NengoGUI</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/community.html">Community</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://forum.nengo.ai/">Forum</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/summerschool.html">Summer School</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/people.html">People</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/projects.html">Development</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://www.nengo.ai/contributing.html">Contributor Guide</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/projects.html">Ecosystem</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item"><a href="https://www.nengo.ai/README.html">About</a></li>
          <li class="btn-link w-nav-link menu-item"><a href="https://www.nengo.ai/download.html">Download</a></li>
        </ul>
      </div>

      <a href="#mobile-nav" class="fa fa-bars mobile-nav-button"></a>
    </div>
  </div>
</header>

<div class="w-section section border-top">
  <div class="container">
    <div class="row" id="examples/adaptive_motor_control">
      <div class="col-md-4 col-lg-3">
        <aside class="wrapper-navleft"><div role="complementary" class="bs-docs-sidebar hidden-print" id="nav-affix">
  <ul class="bs-docs-sidenav bs-sidenav nav" role="complementary">
    <a href="../index.html">
      <img class="logo" src="https://www.nengo.ai/design/_images/nengo-loihi-full-light.svg" alt="Nengo Loihi" width="200" />
    </a>
    <ul class="toctree nav nav-list">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Example models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="communication_channel.html">Communication channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrator.html">Integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrator_multi_d.html">Multidimensional integrator</a></li>
<li class="toctree-l2"><a class="reference internal" href="oscillator.html">Simple oscillator</a></li>
<li class="toctree-l2"><a class="reference internal" href="oscillator_nonlinear.html">Nonlinear oscillator</a></li>
<li class="toctree-l2"><a class="reference internal" href="neuron_to_neuron.html">Neuron to neuron connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="learn_communication_channel.html">PES learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="keyword_spotting.html">Keyword spotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="mnist_convnet.html">Convolutional networks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Nonlinear adaptive control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Creating-the-arm-simulation-and-reaching-framework">Creating the arm simulation and reaching framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Running-the-network-in-Nengo">Running the network in Nengo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Adding-unexpected-gravity">Adding unexpected gravity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Adding-nonlinear-adaptive-control">Adding nonlinear adaptive control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Running-the-network-with-Nengo-Loihi">Running the network with Nengo Loihi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#model-zoo">Model zoo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/index.html">Hardware setup</a></li>
</ul>

    </ul>
  </ul>
<form id="form-search" class="form-search" action="../search.html" method="get">
  <div class="form-group">
    <input type="text" name="q" class="form-control" placeholder="Search" />
  </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form></div>
          
        </aside>
      </div>
      <div class="col-md-8 col-lg-9">
        <div class="body wrapper-content-right">
          
<div class="version-select-container">
    <div data-delay="0" class="w-dropdown">
        <div class="w-dropdown-toggle toggle">
            <div class="toggle-text">v0.8.0</div>
            <div class="w-icon-dropdown-toggle toggle-icon"></div>
        </div>
        <nav class="w-dropdown-list dropdown-list">
            
            
                <a href="../../examples/adaptive_motor_control.html" class="w-dropdown-link">latest</a>
            

            
                
                <div class="w-dropdown-link">v0.8.0</div>
                
            
                
                    <a href="../../v0.7.0/examples/adaptive_motor_control.html" class="w-dropdown-link">v0.7.0</a>
                
            
        </nav>
    </div>
</div>

          
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Nonlinear-adaptive-control">
<h1>Nonlinear adaptive control<a class="headerlink" href="#Nonlinear-adaptive-control" title="Permalink to this headline">¶</a></h1>
<p>In this example, we will use the PES learning rule to learn the effects of gravity, applied to a 2-joint arm.</p>
<p>This example requires the <code class="docutils literal notranslate"><span class="pre">abr_control</span></code> library. To install it,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">abr</span><span class="o">/</span><span class="n">abr_control</span><span class="o">.</span><span class="n">git</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="n">abr_control</span>
</pre></div>
</div>
<p>Note that while this example uses a simualted 2-joint arm, the underlying network structure is identical to the network previously used to control a physical robot arm.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">abr_control.arms</span> <span class="k">import</span> <span class="n">twojoint</span> <span class="k">as</span> <span class="n">arm</span>
<span class="kn">from</span> <span class="nn">abr_control.controllers</span> <span class="k">import</span> <span class="n">OSC</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">nengo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">nengo_loihi</span>

<span class="n">nengo_loihi</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/build/nengo/nengo-loihi/nengo_loihi/version.py:23: UserWarning: This version of `nengo_loihi` has not been tested with your `nengo` version (3.0.0.dev0). The latest fully supported version is 2.8.0
  nengo.__version__, latest_nengo_version))
/home/travis/virtualenv/python3.5.2/lib/python3.5/site-packages/nengo_dl/version.py:32: UserWarning: This version of `nengo_dl` has not been tested with your `nengo` version (3.0.0.dev0). The latest fully supported version is 2.8.0.
  ((nengo.version.version,) + latest_nengo_version))
WARNING: Logging before flag parsing goes to stderr.
W0624 00:04:28.257790 139716853618496 deprecation_wrapper.py:119] From /home/travis/virtualenv/python3.5.2/lib/python3.5/site-packages/nengo_dl/__init__.py:55: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0624 00:04:28.258917 139716853618496 deprecation_wrapper.py:119] From /home/travis/virtualenv/python3.5.2/lib/python3.5/site-packages/nengo_dl/__init__.py:55: The name tf.logging.WARN is deprecated. Please use tf.compat.v1.logging.WARN instead.

</pre></div></div>
</div>
<div class="section" id="Creating-the-arm-simulation-and-reaching-framework">
<h2>Creating the arm simulation and reaching framework<a class="headerlink" href="#Creating-the-arm-simulation-and-reaching-framework" title="Permalink to this headline">¶</a></h2>
<p>The first thing to do is create the arm simulation to simulate the dynamics of a two link arm, and an operational space controller to calculate what torques to apply to the joints to move the hand in a straight line to the targets.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># set the initial position of the arm</span>
<span class="n">robot_config</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">use_cython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">arm_sim</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">ArmSim</span><span class="p">(</span>
    <span class="n">robot_config</span><span class="o">=</span><span class="n">robot_config</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">q_init</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>

<span class="c1"># create an operational space controller</span>
<span class="n">ctrlr</span> <span class="o">=</span> <span class="n">OSC</span><span class="p">(</span><span class="n">robot_config</span><span class="p">,</span> <span class="n">kp</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">kv</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Robot has fewer DOF (2) than the specified number of space dimensions to control (3). Poor performance may result.

</pre></div></div>
</div>
<p>Next we create a set of targets for the arm to reach to. In this task the hand will start at a center location, then reach out and back to 4 targets around a circle.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a set of targets to reach to</span>
<span class="n">n_reaches</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">distance</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span>
<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
<span class="n">end_points</span> <span class="o">=</span> <span class="p">[[</span><span class="n">distance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">distance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
              <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_reaches</span><span class="o">+</span><span class="mi">1</span><span class="p">)][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([[</span><span class="n">center</span><span class="p">,</span> <span class="n">ep</span><span class="p">]</span> <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">end_points</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;bx&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">end_point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">end_points</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">end_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
             <span class="n">end_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
             <span class="s1">&#39;x&#39;</span><span class="p">,</span>
             <span class="n">mew</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x7f121396d9b0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_5_1.png" src="../_images/examples_adaptive_motor_control_5_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">build_baseline_model</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nonlinear adaptive control&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>

        <span class="c1"># Create node that specifies target</span>
        <span class="k">def</span> <span class="nf">gen_target</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="c1"># Advance to the next target in the list every 2 seconds</span>
            <span class="k">return</span> <span class="n">targets</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)]</span>
        <span class="n">target_node</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">gen_target</span><span class="p">,</span> <span class="n">size_out</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Create node that calculates the OSC signal</span>
        <span class="n">model</span><span class="o">.</span><span class="n">osc_node</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">ctrlr</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                <span class="n">q</span><span class="o">=</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dq</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">target</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)])),</span>
            <span class="n">size_in</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size_out</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Create node that runs the arm simulation and gets feedback</span>
        <span class="k">def</span> <span class="nf">arm_func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># the OSC signal</span>
            <span class="n">u</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># add in the adaptive control signal</span>
            <span class="n">arm_sim</span><span class="o">.</span><span class="n">send_forces</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>  <span class="c1"># step the arm simulation forward</span>
            <span class="c1"># return arm joint angles, joint velocities, and hand (x,y)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">arm_sim</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">arm_sim</span><span class="o">.</span><span class="n">dq</span><span class="p">,</span> <span class="n">arm_sim</span><span class="o">.</span><span class="n">x</span><span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">arm_node</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">arm_func</span><span class="p">,</span> <span class="n">size_in</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># hook up the OSC controller and arm simulation</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">osc_node</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">osc_node</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
        <span class="c1"># send in current target to the controller</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">target_node</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">osc_node</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>

        <span class="n">model</span><span class="o">.</span><span class="n">probe_target</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span>  <span class="c1"># track targets</span>
        <span class="n">model</span><span class="o">.</span><span class="n">probe_hand</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>  <span class="c1"># track hand (x,y)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">probe_q</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># track joint angles</span>

    <span class="k">return</span> <span class="n">model</span>


<span class="n">baseline_model</span> <span class="o">=</span> <span class="n">build_baseline_model</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generating transform function for joint0[0,0,0]_Tx
Generating transform function for joint1[0,0,0]_Tx
Generating transform function for EE[0,0,0]_Tx
</pre></div></div>
</div>
</div>
<div class="section" id="Running-the-network-in-Nengo">
<h2>Running the network in Nengo<a class="headerlink" href="#Running-the-network-in-Nengo" title="Permalink to this headline">¶</a></h2>
<p>We can now run the basic framework, where the operational space controller will drive the hand to the 4 targets around the circle.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># each reach is 2 seconds out + 2 seconds back in</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="n">n_reaches</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>

<span class="n">arm_sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">baseline_model</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>
<span class="n">baseline_t</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">()</span>
<span class="n">baseline_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
E0624 00:04:34.042649 139716853618496 cache.py:381] Decoder cache index corrupted. Reinitializing cache.
Traceback (most recent call last):
  File &#34;/home/travis/virtualenv/python3.5.2/lib/python3.5/site-packages/nengo/cache.py&#34;, line 378, in __enter__
    self._load_index_file()
  File &#34;/home/travis/virtualenv/python3.5.2/lib/python3.5/site-packages/nengo/cache.py&#34;, line 303, in _load_index_file
    with open(self.index_path, &#39;rb&#39;) as f:
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/travis/.cache/nengo/decoders/index&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generating Jacobian function for EE[0,0,0]_J
Loading expression from EE[0,0,0]_Tx ...
Generating inertia matrix function
Generating Jacobian function for link0[0,0,0]_J
Generating transform function for link0[0,0,0]_Tx
Generating Jacobian function for link1[0,0,0]_J
Generating transform function for link1[0,0,0]_Tx
Generating Jacobian function for link2[0,0,0]_J
Generating transform function for link2[0,0,0]_Tx
Generating Jacobian function for joint0[0,0,0]_J
Loading expression from joint0[0,0,0]_Tx ...
Generating Jacobian function for joint1[0,0,0]_J
Loading expression from joint1[0,0,0]_Tx ...
Generating gravity compensation function
Loading expression from link0[0,0,0]_J ...
Loading expression from link1[0,0,0]_J ...
Loading expression from link2[0,0,0]_J ...
Loading expression from joint0[0,0,0]_J ...
Loading expression from joint1[0,0,0]_J ...
</pre></div></div>
</div>
<p>The error is calculated as the difference between the hand (x,y) position and the target. Whenever the target changes, the error will jump up, and then quickly decrease as the hand approaches the target.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">calculate_error</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">probe_hand</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">probe_target</span><span class="p">]</span>


<span class="n">baseline_error</span> <span class="o">=</span> <span class="n">calculate_error</span><span class="p">(</span><span class="n">baseline_model</span><span class="p">,</span> <span class="n">baseline_data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">t_set</span><span class="p">,</span> <span class="n">data_set</span><span class="p">,</span> <span class="n">label_set</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distance to target&quot;</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;X error&#39;</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t_set</span><span class="p">,</span> <span class="n">data_set</span><span class="p">,</span> <span class="n">label_set</span><span class="p">):</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_xy</span><span class="p">(</span><span class="n">t_set</span><span class="p">,</span> <span class="n">data_set</span><span class="p">,</span> <span class="n">label_set</span><span class="p">):</span>
    <span class="n">tspace</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">ttol</span> <span class="o">=</span> <span class="mf">1e-5</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;kx&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">end_points</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">end_points</span><span class="p">],</span>
            <span class="s1">&#39;mx&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Targets&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t_set</span><span class="p">,</span> <span class="n">data_set</span><span class="p">,</span> <span class="n">label_set</span><span class="p">):</span>
        <span class="n">tmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">ttol</span><span class="p">)</span> <span class="o">%</span> <span class="n">tspace</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">ttol</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">tmask</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">tmask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>


<span class="n">plot_xy</span><span class="p">(</span>
    <span class="p">[</span><span class="n">baseline_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">baseline_data</span><span class="p">[</span><span class="n">baseline_model</span><span class="o">.</span><span class="n">probe_hand</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">])</span>
<span class="n">plot_data</span><span class="p">(</span>
    <span class="p">[</span><span class="n">baseline_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">baseline_error</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_10_0.png" src="../_images/examples_adaptive_motor_control_10_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_10_1.png" src="../_images/examples_adaptive_motor_control_10_1.png" />
</div>
</div>
</div>
<div class="section" id="Adding-unexpected-gravity">
<h2>Adding unexpected gravity<a class="headerlink" href="#Adding-unexpected-gravity" title="Permalink to this headline">¶</a></h2>
<p>Now we add gravity along the y-axis to the 2-link arm model, which it is not expecting. As a result, the error will be much greater as it tries to reach to the various targets relative to baseline performance. Note that although gravity is only applied along the y-axis, because the arm joints are not all oriented vertically, the effect of gravity on the arm segments also pulls the hand along the x-axis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">add_gravity</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">model</span><span class="p">:</span>
        <span class="c1"># calculate and add in gravity along y axis</span>
        <span class="n">gravity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">M0g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">robot_config</span><span class="o">.</span><span class="n">_M_LINKS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gravity</span><span class="p">)</span>
        <span class="n">M1g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">robot_config</span><span class="o">.</span><span class="n">_M_LINKS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gravity</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">gravity_func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">robot_config</span><span class="o">.</span><span class="n">J</span><span class="p">(</span><span class="s1">&#39;link1&#39;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">M0g</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">robot_config</span><span class="o">.</span><span class="n">J</span><span class="p">(</span><span class="s1">&#39;link2&#39;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">M1g</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">g</span>
        <span class="n">gravity_node</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">gravity_func</span><span class="p">,</span> <span class="n">size_in</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size_out</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># connect perturbation to arm</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">gravity_node</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">gravity_node</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">model</span>


<span class="n">gravity_model</span> <span class="o">=</span> <span class="n">add_gravity</span><span class="p">(</span><span class="n">build_baseline_model</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arm_sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">gravity_model</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>
<span class="n">gravity_t</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">()</span>
<span class="n">gravity_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading expression from link1[0,0,0]_J ...
Loading expression from link2[0,0,0]_J ...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gravity_error</span> <span class="o">=</span> <span class="n">calculate_error</span><span class="p">(</span><span class="n">gravity_model</span><span class="p">,</span> <span class="n">gravity_data</span><span class="p">)</span>
<span class="n">plot_xy</span><span class="p">(</span>
    <span class="p">[</span><span class="n">gravity_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">gravity_data</span><span class="p">[</span><span class="n">gravity_model</span><span class="o">.</span><span class="n">probe_hand</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;Gravity&#39;</span><span class="p">])</span>
<span class="n">plot_data</span><span class="p">(</span>
    <span class="p">[</span><span class="n">baseline_t</span><span class="p">,</span> <span class="n">gravity_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">baseline_error</span><span class="p">,</span> <span class="n">gravity_error</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;Gravity&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_14_0.png" src="../_images/examples_adaptive_motor_control_14_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_14_1.png" src="../_images/examples_adaptive_motor_control_14_1.png" />
</div>
</div>
<p>As expected, the error is much worse, especially along the Y axis (take note of the scale of the axes), because gravity is affecting the system and the operational space controller is not accounting for it.</p>
</div>
<div class="section" id="Adding-nonlinear-adaptive-control">
<h2>Adding nonlinear adaptive control<a class="headerlink" href="#Adding-nonlinear-adaptive-control" title="Permalink to this headline">¶</a></h2>
<p>Now we add in an ensemble of neurons to perform context sensitive error integration, as presented in DeWolf, Stewart, Slotine, and Eliasmith, 2015. We want the context for adaptation to be the joint angles of the arm. For optimal performance, the input to the ensemble should be in the range -1 to 1, so we need to look at the expected range of joint angles and transform the input signal accordingly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span>
             <span class="n">baseline_data</span><span class="p">[</span><span class="n">baseline_model</span><span class="o">.</span><span class="n">probe_q</span><span class="p">][:,</span> <span class="n">ii</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Baseline&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">(),</span>
             <span class="n">gravity_data</span><span class="p">[</span><span class="n">gravity_model</span><span class="o">.</span><span class="n">probe_q</span><span class="p">][:,</span> <span class="n">ii</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gravity&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Joint </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ii</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_17_0.png" src="../_images/examples_adaptive_motor_control_17_0.png" />
</div>
</div>
<p>Looking at this data, we can estimate the mean of Joint 0 across the two runs to be around .75, with a range of .75 to either side of the mean. For Joint 1 it’s a bit more difficult; we’re going to err to the Baseline values with the hope the adaptive controller helps keep us in that range. So we’ll choose a mean of 2 and range of 1 to either side of the mean.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">add_adaptation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">model</span><span class="p">:</span>
        <span class="c1"># create ensemble to adapt to unmodeled dynamics</span>
        <span class="n">adapt</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Ensemble</span><span class="p">(</span><span class="n">n_neurons</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">])</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">])</span>
        <span class="n">scale_node</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">means</span><span class="p">)</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">,</span>
            <span class="n">size_in</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">size_out</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># to send target info to ensemble</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">scale_node</span><span class="p">)</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">scale_node</span><span class="p">,</span> <span class="n">adapt</span><span class="p">)</span>

        <span class="c1"># create the learning connection from adapt to the arm simulation</span>
        <span class="n">learn_conn</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">adapt</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">arm_node</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span>
            <span class="n">function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">learning_rule_type</span><span class="o">=</span><span class="n">nengo</span><span class="o">.</span><span class="n">PES</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">),</span>
            <span class="n">synapse</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="c1"># connect up the osc signal as the training signal</span>
        <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
            <span class="n">model</span><span class="o">.</span><span class="n">osc_node</span><span class="p">,</span> <span class="n">learn_conn</span><span class="o">.</span><span class="n">learning_rule</span><span class="p">,</span> <span class="n">transform</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="n">adapt_model</span> <span class="o">=</span> <span class="n">add_adaptation</span><span class="p">(</span><span class="n">add_gravity</span><span class="p">(</span><span class="n">build_baseline_model</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arm_sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">adapt_model</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>
<span class="n">adapt_t</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">()</span>
<span class="n">adapt_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">adapt_error</span> <span class="o">=</span> <span class="n">calculate_error</span><span class="p">(</span><span class="n">adapt_model</span><span class="p">,</span> <span class="n">adapt_data</span><span class="p">)</span>
<span class="n">plot_xy</span><span class="p">(</span>
    <span class="p">[</span><span class="n">adapt_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">adapt_data</span><span class="p">[</span><span class="n">adapt_model</span><span class="o">.</span><span class="n">probe_hand</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;Adapt&#39;</span><span class="p">])</span>
<span class="n">plot_data</span><span class="p">(</span>
    <span class="p">[</span><span class="n">baseline_t</span><span class="p">,</span> <span class="n">gravity_t</span><span class="p">,</span> <span class="n">adapt_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">baseline_error</span><span class="p">,</span> <span class="n">gravity_error</span><span class="p">,</span> <span class="n">adapt_error</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;Gravity&#39;</span><span class="p">,</span> <span class="s1">&#39;Gravity + Adapt&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_21_0.png" src="../_images/examples_adaptive_motor_control_21_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_21_1.png" src="../_images/examples_adaptive_motor_control_21_1.png" />
</div>
</div>
<p>And we can see that even in only one pass through the target set the adaptive ensemble has already significantly reduced the error. To see further reductions, change the run time of the simulation to be longer so that the arm does multiple passes of the target set (by changing <code class="docutils literal notranslate"><span class="pre">sim.run(runtime)</span></code> to <code class="docutils literal notranslate"><span class="pre">sim.run(runtime*2)</span></code>).</p>
</div>
<div class="section" id="Running-the-network-with-Nengo-Loihi">
<h2>Running the network with Nengo Loihi<a class="headerlink" href="#Running-the-network-with-Nengo-Loihi" title="Permalink to this headline">¶</a></h2>
<p>Loihi has limits on the magnitude of the error signal, so we need to adjust the <code class="docutils literal notranslate"><span class="pre">pes_error_scale</span></code> parameter to avoid too much overflow.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arm_sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">nengo_loihi</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">pes_error_scale</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">with</span> <span class="n">nengo_loihi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">adapt_model</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>
<span class="n">adapt_loihi_t</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">trange</span><span class="p">()</span>
<span class="n">adapt_loihi_data</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/travis/build/nengo/nengo-loihi/nengo_loihi/discretize.py:185: UserWarning: Received PES error greater than chip max (1.27e+01). Consider changing `Model.pes_error_scale`.
  % (max_err / scale,))
/home/travis/build/nengo/nengo-loihi/nengo_loihi/discretize.py:194: UserWarning: Received PES error less than chip min (-1.27e+01). Consider changing `Model.pes_error_scale`.
  % (-max_err / scale,))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">adapt_loihi_error</span> <span class="o">=</span> <span class="n">calculate_error</span><span class="p">(</span><span class="n">adapt_model</span><span class="p">,</span> <span class="n">adapt_loihi_data</span><span class="p">)</span>
<span class="n">plot_xy</span><span class="p">(</span>
    <span class="p">[</span><span class="n">adapt_loihi_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">adapt_loihi_data</span><span class="p">[</span><span class="n">adapt_model</span><span class="o">.</span><span class="n">probe_hand</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;Adapt&#39;</span><span class="p">])</span>
<span class="n">plot_data</span><span class="p">(</span>
    <span class="p">[</span><span class="n">baseline_t</span><span class="p">,</span> <span class="n">gravity_t</span><span class="p">,</span> <span class="n">adapt_t</span><span class="p">,</span> <span class="n">adapt_loihi_t</span><span class="p">],</span>
    <span class="p">[</span><span class="n">baseline_error</span><span class="p">,</span> <span class="n">gravity_error</span><span class="p">,</span> <span class="n">adapt_error</span><span class="p">,</span> <span class="n">adapt_loihi_error</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">,</span> <span class="s1">&#39;Gravity&#39;</span><span class="p">,</span> <span class="s1">&#39;Gravity + Adapt&#39;</span><span class="p">,</span> <span class="s1">&#39;Gravity + Adapt Loihi&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_25_0.png" src="../_images/examples_adaptive_motor_control_25_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_adaptive_motor_control_25_1.png" src="../_images/examples_adaptive_motor_control_25_1.png" />
</div>
</div>
</div>
</div>


        </div>
      </div>
    </div>
  </div>
</div><footer class="footer">
  <div class="w-container">
    <div class="w-clearfix">
      <div class="w-row search">
<form id="form-search" class="form-search" action="../search.html" method="get">
  <div class="form-group">
    <input type="text" name="q" class="form-control" placeholder="Search" />
  </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form></div>
      <div class="w-row mobileAlign">
        <div class="w-col w-col-2 footer-menu">
          <p class="menu-Label">ABR, Inc.</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/products/">Products</a></li>
            <li class="footer-listitem-new "><a href="https://appliedbrainresearch.com/services/">Services</a></li>
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/research/">Research</a></li>
          </ul>
        </div>
        <div class="w-col w-col-2 footer-menu">
          <p class="menu-Label">About Us</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/about-us/">Contact</a></li>
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/about-us/#team">Team</a></li>
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/about-us/#culture">Culture</a></li>
          </ul>
        </div>
        <a class="brand footer-brand" href="https://appliedbrainresearch.com">
          <img src="https://appliedbrainresearch.com/img/logo-light-notext.svg" width="80">
        </a>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>